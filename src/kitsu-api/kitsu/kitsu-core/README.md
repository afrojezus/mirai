# Kitsu Core

[![npm badge]][npm]
[![npm install badge]][npm]
[![david badge]][david]
[![contributors badge]][contributors]
[![donate badge]][donate]

[![travis badge]][travis]
[![appveyor badge]][appveyor]
[![david dev badge]][david dev]
[![cc maintainability badge]][cc maintainability]
[![cc coverage badge]][cc coverage]

Core [JSON:API] serialisation and deserialisation components for [kitsu]

## Features

-   JSON-API 1.0 compliant
-   Automatically links relationships to data
-   Works in Node and on the web
-   Uses the [Promise] API

## Node / Browser Support

|             Package | Package<br> Size\* | Node | Chrome | Firefox | Safari | Edge |  IE |
| ------------------: | :----------------: | :--: | :----: | :-----: | :----: | :--: | :-: |
|        `kitsu-core` |       9.9 kb       |  6+  |   51+  |   47+   |  9.1+  |  14+ |     |
| `kitsu-core/legacy` |       11.8 kb      |  6+  |   4+   |    3+   |  3.1+  |  12+ |  8+ |
|   `kitsu-core/node` |       7.2 kb       |  6+  |        |         |        |      |     |

\* Including all dependencies, minified & gzipped

[default]: http://browserl.ist/?q=last+2+years%2C+not+%3C+0.05%25

[legacy]: http://browserl.ist/?q=last+10+years

## Install

### Yarn / NPM

```bash
yarn add kitsu-core
npm install kitsu-core
```

```js
import { camel } from 'kitsu-core'             // ES Modules and Babel
const { camel } = require('kitsu-core')        // CommonJS and Browserify
const { camel } = require('kitsu-core/legacy') // Legacy IE8+ support
const { camel } = require('kitsu-core/node')   // Lighter node-only package

camel(...)
```

[Try it on RunKit](https://npm.runkit.com/kitsu-core)

### Packd CDN

```html
<script src='https://bundle.run/kitsu-core@5?name=kitsuCore'></script>
<script src='https://bundle.run/kitsu@5/legacy/index.js?name=kitsuCore'></script>
```

```js
kitsuCore.camel(...)
```

[Try it on CodePen](https://codepen.io/wopian/pen/KQZwzq?editors=0010)

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [camel](#camel)
-   [deattribute](#deattribute)
-   [deserialise](#deserialise)
-   [error](#error)
-   [filterIncludes](#filterincludes)
-   [kebab](#kebab)
-   [linkRelationships](#linkrelationships)
-   [query](#query)
-   [serialise](#serialise)
-   [snake](#snake)

### camel

Converts kebab-case and snake_case into camelCase

**Parameters**

-   `s` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** String to convert

**Examples**

_Convert kebab-case_

```javascript
camel('hello-world') // 'helloWorld'
```

_Convert snake_case_

```javascript
camel('hello_world') // 'helloWorld'
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** camelCase formatted string

### deattribute

Hoists attributes to be top-level

**Parameters**

-   `data` **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array))** Resource data

**Examples**

_Deattribute an array of resources_

```javascript
// JSON:API 'data' field
const data = [
  {
    id: '1',
    type: 'users',
    attributes: { slug: 'wopian' }
  }
]

const output = await deattribute(data) // [ { id: '1', type: 'users', slug: 'wopian' } ]
```

_Deattribute a resource_

```javascript
// JSON:API 'data' field
const data = {
  id: '1',
  type: 'users',
  attributes: { slug: 'wopian' }
}

const output = await deattribute(data) // { id: '1', type: 'users', slug: 'wopian' }
```

Returns **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array))** Deattributed resource data

### deserialise

Deserialises a JSON-API response

**Parameters**

-   `obj` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The response

**Examples**

_Deserialise with a basic data object_

```javascript
await deserialise({
  data: {
    id: '1',
    attributes: { liked: true }
  },
  meta: { hello: 'world' }
}) // { data: { id: '1', liked: true }, meta: { hello: 'world' } }
```

_Deserialise with relationships_

```javascript
await deserialise({
  data: {
    id: '1',
    relationships: {
      user: {
        data: {
          type: 'users',
          id: '2' }
      }
    }
  },
  included: [
    {
      type: 'users',
      id: '2',
      attributes: { slug: 'wopian' }
    }
  ]
}) // { data: { id: '1', user: { type: 'users', id: '2', slug: 'wopian' } } }
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The deserialised response

### error

Mutates an error and rethrows it

**Parameters**

-   `E` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The Error


-   Throws **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The mutated Error

### filterIncludes

Filters includes for the specific relationship

**Parameters**

-   `included` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The response included object
-   `opts` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `opts.id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The relationship ID
    -   `opts.type` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The relationship type

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** The matched includes

### kebab

Converts camelCase into kebab-case

**Parameters**

-   `s` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** camelCase string

**Examples**

```javascript
kebab('helloWorld') // 'hello-world'
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** kekab-case formatted string

### linkRelationships

Links relationships to included data

**Parameters**

-   `data` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The response data object
-   `included` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The response included object

### query

Constructs a URL query string for JSON:API parameters

**Parameters**

-   `params` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Parameters to parse
-   `prefix` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Prefix returned string with `?` (default `false`) (optional, default `false`)

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** URL query string

### serialise

Serialises an object into a JSON-API structure

**Parameters**

-   `model` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Request model
-   `obj` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The data (optional, default `{}`)
-   `method` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Request type (optional, default `'POST'`)

**Examples**

_Due to its usage in kitsu, it **MUST** be called with **this** set in 5.0.x_

```javascript
import { serialise, camel, kebab } from 'kitsu-core'
import plural from 'pluralize'

const output = await serialise.apply({ camel, resCase: kebab, plural }, [ model, obj, 'PATCH' ])
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** The serialised data

### snake

Converts camelCase into snake_case

**Parameters**

-   `s` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** camelCase string

**Examples**

```javascript
snake('helloWorld') // 'hello_world'
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** snake_case formatted string

## Contributing

See [CONTRIBUTING]

## Releases

See [CHANGELOG]

## License

All code released under [MIT]

[kitsu]: https://github.com/wopian/kitsu#readme

[json:api]: http://jsonapi.org

[promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises

[changelog]: https://github.com/wopian/kitsu/blob/master/packages/kitsu-core/CHANGELOG.md

[contributing]: https://github.com/wopian/kitsu/blob/master/CONTRIBUTING.md

[mit]: https://github.com/wopian/kitsu/blob/master/LICENSE.md

[npm]: https://www.npmjs.com/package/kitsu-core

[npm badge]: https://img.shields.io/npm/v/kitsu-core.svg?style=flat-square

[npm install badge]: https://img.shields.io/npm/dt/kitsu-core.svg?style=flat-square

[travis]: https://travis-ci.org/wopian/kitsu

[travis badge]: https://img.shields.io/travis/wopian/kitsu/master.svg?style=flat-square&label=linux%20%26%20macOS

[appveyor]: https://ci.appveyor.com/project/wopian/kitsu

[appveyor badge]: https://img.shields.io/appveyor/ci/wopian/kitsu/master.svg?style=flat-square&label=windows

[cc coverage]: https://codeclimate.com/github/wopian/kitsu/code

[cc coverage badge]: https://img.shields.io/codeclimate/c/wopian/kitsu.svg?style=flat-square

[cc maintainability]: https://codeclimate.com/github/wopian/kitsu

[cc maintainability badge]: https://img.shields.io/codeclimate/maintainability/wopian/kitsu.svg?style=flat-square

[david]: https://david-dm.org/wopian/kitsu?path=packages/kitsu-core

[david badge]: https://david-dm.org/wopian/kitsu/status.svg?path=packages/kitsu-core&style=flat-square

[david dev]: https://david-dm.org/wopian/kitsu?type=dev

[david dev badge]: https://img.shields.io/david/dev/wopian/kitsu.svg?style=flat-square

[contributors]: https://github.com/wopian/kitsu/graphs/contributors

[contributors badge]: https://img.shields.io/github/contributors/wopian/kitsu.svg?style=flat-square

[donate]: https://www.patreon.com/wopian

[donate badge]: https://img.shields.io/badge/patreon-donate-ff69b4.svg?style=flat-square
